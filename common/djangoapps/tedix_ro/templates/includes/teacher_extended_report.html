<%page args="report_data, header"/>
<%!
from django.utils.translation import ugettext as _
%>

<div class="extended-report" style="overflow-x: scroll;">
    <table class="teacher-extended-report" style="border-collapse: collapse; border: 1px solid;">
        <thead>
            <tr>
                <th style="box-sizing: border-box; min-width: 150px; max-width: 150px; border: 1px solid; padding: 10px 32px 10px 8px;">${_("Student name")}</th>
                %for question_name, question_type in header:
                    <th style="box-sizing: border-box; min-width: 150px; max-width: 150px; border: 1px solid; padding: 10px 8px; border-color: black; ${'color: white; background: #0075b4;' if question_type == 'video_lesson' else 'background: #ffce00;' if question_type == 'problem' else '' }">
                        <p>${_("Video question") if question_type == 'video_lesson' else _("Question")} ${loop.index + 1}:
                        <br>${ question_name }</p>
                    </th>
                %endfor
                <th style="border: 1px solid; padding: 10px 8px;">${_("Score")}</th>
                <th style="border: 1px solid; padding: 10px 8px;">${_("Lesson completed")}</th>
            </tr>
        </thead>
        <tbody>
            %for user_data in report_data:
                <tr>
                    <th style="border: 1px solid; padding: 10px 8px; color: white; border-color: black; ${'background: #24ad97;' if user_data['completion'] == 1 else 'background: #d9534f;'}">
                        ${ user_data['full_name'] }
                    </th>
                    %for question_data in user_data['questions']:
                    <%
                        earned = question_data['score_info'].get('earned', 0)
                        possible = question_data['score_info'].get('possible', 0)
                    %>
                        <td style="white-space: nowrap; border: 1px solid; padding: 9px 8px; text-align: center;">
                            %if question_data['type'] == 'video_lesson':
                                %if question_data['attempts'] == 1:
                                    <span style="color: #24ad97;">${ _('First attempt') }</span>
                                %else:
                                    <span style="color: #ff0900;">${ question_data['attempts'] } ${ _("attempt") if question_data['attempts'] == 1 else _("attempts")}</span>
                                %endif
                            %else:
                                %if earned > 0 and earned < possible:
                                    <span style="color: #d3620b;">${_('Partially correct')}</span>
                                %elif earned!=0 and earned == possible:
                                    <span style="color: #24ad97;">${_('Correct')}</span>
                                %else:
                                    <span style="color: #ff0900;">${_('Incorrect')}</span>
                                %endif
                            %endif
                            <br>
                            <span style="margin-top: 5px; display: inline-block; font-size: 0.9em;">${ earned } / ${ possible }</span>
                        </td>
                    %endfor
                    <td style="white-space: nowrap; border: 1px solid; padding: 9px 8px;">${ user_data['percent'] }</td>
                    <td style="white-space: nowrap; border: 1px solid; padding: 9px 8px;color: white; border-color: black; ${'background: #24ad97;' if user_data['completion'] == 1 else 'background: #d9534f;'}">
                        ${_('Yes') if user_data['completion'] == 1 else _('No')}
                    </td>
                </tr>
            %endfor
        </tbody>
    </table>
</div>
