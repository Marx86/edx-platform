## mako

<%page expression_filter="h" args="online_help_token, use_cookie_banner=False"/>

<%namespace name='static' file='../static_content.html'/>
<%namespace file='../main.html' import="login_query"/>
<%!
from django.urls import reverse
from django.utils.translation import ugettext as _

from lms.djangoapps.ccx.overrides import get_current_ccx
from openedx.core.djangolib.markup import HTML, Text

# App that handles subdomain specific branding
from branding import api as branding_api
from openedx.core.djangoapps.lang_pref.api import header_language_selector_is_enabled, released_languages

%>

## Provide a hook for themes to inject branding on top.
<%block name="navigation_top" />

## Add UI Toolkit components if using the Pattern Library
% if uses_pattern_library:
    <%block name="js_extra">
    <%static:require_module module_name="js/header_factory" class_name="HeaderFactory">
    HeaderFactory();
    </%static:require_module>
    </%block>
% endif
  <script type="text/javascript"><!--
		function Showdemo5() {
			$(".modal-overlay-video").toggleClass("hidden");
			$("#demo-modal5").toggleClass("hidden");
			$('.modal-overlay-video').on( "click", function()	{ Showdemo5()});
		}	
		function Showdemo6() {
			$(".modal-overlay-video").toggleClass("hidden");
			$("#demo-modal6").toggleClass("hidden");
			$('.modal-overlay-video').on( "click", function()	{ Showdemo6()});
		}	
		function Showdemo7() {
			$(".modal-overlay-video").toggleClass("hidden");
			$("#demo-modal7").toggleClass("hidden");
			$('.modal-overlay-video').on( "click", function()	{ Showdemo7()});
		}	
		function Showdemo8() {
			$(".modal-overlay-video").toggleClass("hidden");
			$("#demo-modal8").toggleClass("hidden");
			$('.modal-overlay-video').on( "click", function()	{ Showdemo8()});
		}			
	function Blockingnoplan() {
			$(".modal-overlay").show()
			$(".modal-window").show()
			document.body.style.overflow = "hidden";
	}
	function Blockingplan() {
			$(".modal-overlay").show()
			$(".modal-window-plan").show()
			document.body.style.overflow = "hidden";
	}
	function Showplans() {
		$(".modal-overlay").toggleClass("hidden");
		$("#plans-modal").toggleClass("hidden");
	}
	
//--></script>
        % if user.is_authenticated:
	  <script type="text/javascript">
  (function(d) {
  var plan1="5f4f68bc68c04f75643ed572";
  var plan2="5f4f692268c04f758103f792";
  var plan3="5f4f693e68c04f758e084d32";
  var curent_timestamp=Math.floor(Date.now() / 1000);
  var user_created_time=tedixUUid.created;
  var user_type=tedixUUid.usertype;
  var homework=tedixUUid.lesson_is_active_homework;
  console.log(homework)
  if (tedixUUid.usertype =="student" ){
	      window.__simpleShopConfig = {
      storeId: 'JPJHNTSHMW',
      shopActions: {
        openWindow: '.selectPlanLink',
      },
      shopOverride: {
        productCta: 'Cumpără',
		productSort: 'price:asc',
		heroHtml: '<span style="text-align:center;display: block;font-size: 18px;"><span style="color:red;padding: 5px;line-height: 1;font-size: 29px;vertical-align: middle;">&#8226;</span>Acces gratuit pentru profesori<span style="color:red;padding: 5px;line-height: 1;font-size: 29px;vertical-align: middle;">&#8226;</span></span><span style="text-align:center;display: block;font-size: 18px;"><span style="color:red;padding: 5px;line-height: 1;font-size: 29px;vertical-align: middle;">&#8226;</span>Elevii au 30 de zile GRATUITE<span style="color:red;padding: 5px;line-height: 1;font-size: 29px;vertical-align: middle;">&#8226;</span></span><span style="text-align:center;display: block;font-size: 16px;"> (din momentul înregistrării)</span><br><div><div class="mb-3"><div class="sscard cart-item-card" style="background-color: rgb(251, 248, 246); border: 1px solid transparent;"><div class="ssrow no-gutters"><div class="col-4"><a href="#"><div class="image-container" style="background-image:url(&quot;https://dev2.tedix.ro/static/red-theme/images/grup.png&quot;);"><!----> <!----></div></a></div> <div class="col-8 content-column"><div class="card-body-container card-body-size-small"><div class="card-body"><h5 class="card-title" style="color: red;font-family: Helvetica Neue;" helvetica="">Abonament de grup</h5> <!----> <!---->  <div><div><div class="price mb-2" style="color: rgb(23, 162, 184); font-family: &quot;Helvetica Neue&quot;;"><span class="old-price" style="display: none;"></span>Contactaţi-ne pentru ofertă<!----> <div class="price-note"></div></div> <div><div class="cart-item-controls" style="color: rgb(0, 0, 0); font-family: &quot;Helvetica Neue&quot;;"><div><a href="mailto:contact@tedix.ro" class="ssbtn btn-light" style="color: rgb(0, 0, 0); background-color: rgb(238, 238, 238); border: none;">Contact</a></div></div> </div></div></div> <div style="display: none;"><span class="item-quantity no-stock">Fără stoc</span></div></div></div></div></div></div></div></div><hr>',
      },
      euid: tedixUUid.id,
      onLoad: interface => {
      interface.getLastTransaction().then(ret => {
	  	  if ( homework == false){
	            if (! ret.number || ret.payment_status =="rejected") {
            //$('.message-noplan').show()
            //$('.message-plan').hide()
			console.log("Status plata respinsa : " + ret.payment_status);
			var time_since_creation=curent_timestamp - user_created_time;
			var noplan_remaining_days = 30 - ((time_since_creation / (24 * 3600)).toFixed(0));
			console.log("ct" + curent_timestamp);
			console.log("uct" + user_created_time);
			console.log("utr" + time_since_creation);
			$(".insert").html(noplan_remaining_days);
			if(noplan_remaining_days >0 && noplan_remaining_days <= 7 ) {
				$('.announces-red').show()
			} else{
				if(noplan_remaining_days > 7  && noplan_remaining_days <= 30) {
					$('.announces-green').show()
				} else{
						//setInterval( Blockingnoplan, 2*6*1000 );
				}
			}
          } else {
		  var payment_time=ret._created;
		  console.log(user_created_time);
		  var paymentstatus=ret.payment_status;
		  console.log("Status plata : " + paymentstatus);
		  var time_since_creation=curent_timestamp - user_created_time;
			switch(ret.content.data.items[0]._id) {
				case '5f4f68bc68c04f75643ed572':
					var user_time_time_remaning=ret._created + 2592000 - curent_timestamp;
					//console.log(user_time_time_remaning)
					break;
				case '5f4f692268c04f758103f792':
					var user_time_time_remaning=ret._created + 7776000 - curent_timestamp;
					//console.log(user_time_time_remaning)
					break;
				case '5f4f693e68c04f758e084d32':
					var user_time_time_remaning=ret._created + 31104000 - curent_timestamp ;
					//console.log(user_time_time_remaning)
					break;
			}
			if (time_since_creation <= 30 * 24 * 3600){
				user_time_time_remaning_final = user_time_time_remaning + (30* 24 * 3600) - ret._created + user_created_time 
			} else{
				user_time_time_remaning_final = user_time_time_remaning
			}
			days_remaning=(user_time_time_remaning_final / (24 * 3600)).toFixed(0);
			console.log("Time remaning final " +  days_remaning)
			$(".insert").html(days_remaning);
            $('.message-noplan').hide()
            $('.message-plan').html(
              '<strong>' + interface.getExternalUID() + '</strong> ' 
              + JSON.stringify(ret)).hide()
			
			if(days_remaning >30 ) {
				console.log("Userul mai are abonament")
			} else{
				if (days_remaning > 15  && days_remaning <=  30) {	
					$('.announces-green-new').show()
				} else{
				if  (days_remaning >  0  && days_remaning <= 15){
					$('.announces-red-new').show()
				} else{
					//setInterval( Blockingplan, 2*6*1000 );
				}
				}
			}
          }
	  
	  }
	  else{
		console.log("Userul are teme de casa: ")
	  }
        })
      }
    }
	    function l() {var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://install-dev.simpleshop.ro/simpleshop.js';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(window.attachEvent){window.attachEvent('onload',l);}else{window.addEventListener('load',l,false);}
  }
  }
)(document)
  </script>	
	<div class="announces-green" style="background-color:#24AD97;padding:15px;color: #ffffff;text-align:center;display:none;">
		<span class="" style="text-align:center;font-size:16px;">Bine ai venit pe platforma TEDIX! <b>Mai ai <span class="insert">.</span> zile de utilizare gratuită a sistemului. Abonează-te dând click </b> <a href="javascript:;" class="selectPlanLink" style="background-color:orange;border-radius:5px;padding:5px 20px;color:#ffffff;display:inline-block;">Aici</a></span>
	</div>
	<div class="announces-green-new" style="background-color:#24AD97;padding:15px;color: #ffffff;text-align:center;display:none;">
		<span class="" style="text-align:center;font-size:16px;">Mulțumim că utilizezi platforma TEDIX. <b> Mai ai <span class="insert">.</span> zile până la expirarea abonamentului. Reînnoiește-ți abonamentul dând click</b> <a href="javascript:;" class="selectPlanLink" style="background-color:orange;border-radius:5px;padding:5px 20px;color:#ffffff;display:inline-block;">Aici</a></span>
	</div>
	<div class="announces-red" style="background-color:#c90000;padding:15px;color: #ffffff;text-align:center;display:none;">
		<span class="" style="text-align:center; font-size:16px;">Bine ai venit pe platforma TEDIX! <b>Mai ai <span class="insert">.</span> zile de utilizare gratuită a sistemului. Abonează-te dând click </b> <a href="javascript:;" class="selectPlanLink" style="background-color:orange;border-radius:5px;padding:5px 20px;color:#ffffff;display: inline-block;">Aici</a></span>
	</div>
	<div class="announces-red-new" style="background-color:#c90000;padding:15px;color: #ffffff;text-align:center;display:none;">
		<span class="" style="text-align:center; font-size:16px;">Mulțumim că utilizezi platforma TEDIX. <b>Mai ai <span class="insert">.</span> zile până la expirarea abonamentului. Reînnoiește-ți abonamentul dând click</b> <a href="javascript:;" class="selectPlanLink" style="background-color:orange;border-radius:5px;padding:5px 20px;color:#ffffff;display: inline-block;">Aici</a></span>
	</div>
	<div class="modal-window" style="display:none;">
		<div class="logo" style=""><img src="${static.url("images/logo.png" )}" style="width:70%;max-width:40vw;"></div>
		<div style="text-align:center;padding: 5% 2%;font-weight: normal;">
			<p style="color:#ec6765">Platforma TEDIX este GRATUITA in scop didactic.</p>
			<p>Perioada de gratie a abonamentului dumneavoastra s-a incheiat.</p>
			<p>Temele si lectiile se pot accesa gratuit pana la data limita stabilita de profesor.</p>
			<p>Pentru aceasta tema/lectie ai depasit data limita stabilta de profesor.</p>
			<p>Pentru a putea accesa aceasta lectie (sau alte lectii), alege un abonament apasand butonul de mai jos:</p>
		</Div>
		<div class="modal-content"style="">
		  <div style="display:none !important;"class="alert alert-danger mb-3 message-noplan">The set user doesn't have a payment plan</div>
			<div class="alert alert-info mb-3 message-plan" style="display:none;">...</div>
			<a href="javascript:;" id="selectPlanLink" class="btn btn-primary selectPlanLink" style="">Cumpară Abonament</a>
		</div>
	</div>
	<div class="modal-window-plan" style="display:none;">
		<div class="logo" style=""><img src="${static.url("images/logo.png" )}" style="width:70%;max-width:40vw;"></div>
		<div style="text-align:center;padding: 5% 2%;font-weight: normal;">
			<p style="color:#ec6765">Platforma TEDIX este GRATUITA in scop didactic.</p>
			<p>Temele si lectiile se pot accesa gratuit pana la data limita stabilita de profesor.</p>
			<p>Pentru aceasta tema/lectie ai depasit data limita stabilta de profesor.</p>
			<p>Pentru a putea accesa aceasta lectie (sau alte lectii), alege un abonament apasand butonul de mai jos:</p>
		</Div>
		<div class="modal-content"style="">
		  <div style="display:none !important;"class="alert alert-danger mb-3 message-noplan">The set user doesn't have a payment plan </div>
			<div class="alert alert-info mb-3 message-plan" style="display:none;">...</div>
			<a href="javascript:;" id="selectPlanLink" class="btn btn-primary selectPlanLink" style="">Cumpară Abonament</a>
		</div>
	</div>
	<div class="modal-overlay" style="display:none;"></div>
        % else:
		<div class="announces-green" style="background-color:#24AD97;padding:15px;color: #ffffff;text-align:center;display:block;">
			<span class="" style="text-align:center;font-size:16px;">Beneficiezi de 30 zile GRATUITE. Inregistreaza-te </b> <a href="/register" class="" style="background-color:orange;border-radius:5px;padding:5px 20px;color:#ffffff;display:inline-block;">Acum</a></span>
		</div>	
	<div  id="plans-modal" class="modal modal-window-plan hidden" style="display:block;width: 350px;top: 50px;border-radius: 10px;">
		<div class="" style=""><img src="${static.url("images/logo.png" )}" style="width:40%;max-width:40vw;"></div>
		<div style="text-align:center;padding: 8% 7%;font-weight: normal;">
				<img src="${static.url("images/vezi-abonamente.png" )}" style="width:100%;max-height: 600px;">
		</Div>
		<div class="modal-content"style="">
			<a onClick="Showplans();return false;" href="#" class="btn btn-primary plans-modal" style="border-radius: 10px;">Închide</a>
		</div>
	</div>
	<div class="modal-overlay hidden"></div>	
        % endif

<header class="global-header ${'slim' if course else ''}">
    % if use_cookie_banner:
        ${static.renderReact(
            component="CookiePolicyBanner",
            id="cookie-policy-banner",
            props={}
        )}
    % endif
    <div class="main-header">
        <%include file="navbar-logo-header.html" args="online_help_token=online_help_token"/>
        <div class="hamburger-menu" role="button" aria-label=${_("Options Menu")} aria-expanded="false" aria-controls="mobile-menu" tabindex="0">
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
            <span class="line"></span>
        </div>
        % if user.is_authenticated:
            <%include file="navbar-authenticated.html" args="online_help_token=online_help_token"/>
        % else:
            <%include file="navbar-not-authenticated.html" args="online_help_token=online_help_token"/>
        % endif
    </div>
    <div class="mobile-menu hidden" aria-label=${_("More Options")} role="menu" id="mobile-menu"></div>
</header>

% if course:
<!--[if lte IE 9]>
<div class="ie-banner" aria-hidden="true">${Text(_('{begin_strong}Warning:{end_strong} Your browser is not fully supported. We strongly recommend using {chrome_link} or {ff_link}.')).format(
    begin_strong=HTML('<strong>'),
    end_strong=HTML('</strong>'),
    chrome_link=HTML('<a href="https://www.google.com/chrome" target="_blank">Chrome</a>'),
    ff_link=HTML('<a href="http://www.mozilla.org/firefox" target="_blank">Firefox</a>'),
)}</div>
<![endif]-->
% endif

% if settings.FEATURES.get('ENABLE_COOKIE_CONSENT', False):
  <%include file="../widgets/cookie-consent.html" />
% endif

% if header_language_selector_is_enabled():
    <% languages = released_languages() %>
    % if len(languages) > 1:
        <form action="/i18n/setlang/" method="post" class="settings-language-form" id="language-settings-form">
            <input type="hidden" id="csrf_token" name="csrfmiddlewaretoken" value="${csrf_token}">
            % if user.is_authenticated:
                <input title="preference api" type="hidden" class="url-endpoint" value="${reverse('preferences_api', kwargs={'username': user.username})}" data-user-is-authenticated="true">
            % else:
                <input title="session update url" type="hidden" class="url-endpoint" value="${reverse('session_language')}" data-user-is-authenticated="false">
            % endif
            <label><span class="sr">${_("Choose Language")}</span>
            <select class="input select language-selector" id="settings-language-value" name="language">
                % for language in languages:
                    % if language[0] == LANGUAGE_CODE:
                        <option value="${language[0]}" selected="selected">${language[1]}</option>
                    % else:
                        <option value="${language[0]}" >${language[1]}</option>
                    % endif
                % endfor
            </select>
            </label>
        </form>
    % endif
% endif
