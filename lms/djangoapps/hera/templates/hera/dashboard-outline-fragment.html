## mako

<%page expression_filter="h"/>

<%namespace name='static' file='../static_content.html'/>

<%!
from datetime import date

from django.utils.translation import ugettext as _

from openedx.core.djangolib.markup import HTML, Text
%>

<%
course_sections = blocks.get('children')
%>
<main role="main" class="course-outline" id="main" tabindex="-1">
<div class="hera-dashboard">
    <div class="hera-dashboard__header">
        <div class="hera-message">
            <div class="hera-message__text">
                <p>
                    Great work! You earned a Gold Medal for States of Matter! Keep going with the remaining lessons.
                </p>
            </div>
            <div class="hera-mascot">
                <img class="hera-mascot__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/mascots/mascot_general.png" alt="/">
            </div>
        </div>
        <div class="hera-grades">
            <div class="hera-grades__item">
                <img class="hera-grades__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/grades/grades_copp.jpg" alt="/">
                <div class="hera-grades__points">
                    60-69 points
                </div>
                <div class="hera-grades__title">
                    Copper
                </div>
            </div>
​
            <div class="hera-grades__item">
                <img class="hera-grades__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/grades/grades_silv.jpg" alt="/">
                <div class="hera-grades__points">
                    70-79 points
                </div>
                <div class="hera-grades__title">
                    Silver
                </div>
            </div>
​
            <div class="hera-grades__item">
                <img class="hera-grades__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/grades/grades_gld.jpg" alt="/">
                <div class="hera-grades__points">
                    80-89 points
                </div>
                <div class="hera-grades__title">
                    Gold
                </div>
            </div>
​
            <div class="hera-grades__item">
                <img class="hera-grades__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/grades/grades_pt.jpg" alt="/">
                <div class="hera-grades__points">
                    90-100 points
                </div>
                <div class="hera-grades__title">
                    Platinum
                </div>
            </div>
        </div>
    </div>
    <div class="hera-dashboard__body">
        <div class="hera-dashboard-progress">
            <div class="hera-dashboard-progress-header">
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Projectile Motion
                    </div>
                    <div class="hera-lesson__status">
                        Complete
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        States of Matter
                    </div>
                    <div class="hera-lesson__status">
                        Complete
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Lesson 3
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Lesson 4
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Lesson 5
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Lesson 6
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Lesson 7
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-header__item">
                    <div class="hera-lesson__title">
                        Lesson 8
                    </div>
                </div>
            </div>
            <div class="hera-dashboard-progress-body">
                <div class="hera-dna-bg">
                    <img class="hera-dna-bg__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/DNA_bg.svg" alt="/">
                </div>
​
                <div class="hera-dashboard-progress-body__item">
                    <div class="dna-connector">
                        <img class="dna-connector__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/copper_top.svg" alt="/">
                    </div>
                    <div class="dna-text">
                  <span class="dna-text__title">
                    MMM
                  </span>
                        <span class="dna-text__points">
                    points
                  </span>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-reverse">
                    <div class="dna-connector">
                        <img class="dna-connector__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/copper_top.svg" alt="/">
                    </div>
                    <div class="dna-text">
                  <span class="dna-text__title">
                    MMM
                  </span>
                        <span class="dna-text__points">
                    points
                  </span>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-unlocked">
                    <div class="dna-unlocked">
                        <div class="dna-icon"></div>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-locked">
                    <div class="dna-locked">
                        <div class="dna-icon">
                            <img class="dna-icon__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/lock_icon.svg" alt="/">
                        </div>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-locked">
                    <div class="dna-locked">
                        <div class="dna-icon">
                            <img class="dna-icon__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/lock_icon.svg" alt="/">
                        </div>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-locked">
                    <div class="dna-locked">
                        <div class="dna-icon">
                            <img class="dna-icon__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/lock_icon.svg" alt="/">
                        </div>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-locked">
                    <div class="dna-locked">
                        <div class="dna-icon">
                            <img class="dna-icon__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/lock_icon.svg" alt="/">
                        </div>
                    </div>
                </div>
​
                <div class="hera-dashboard-progress-body__item is-locked">
                    <div class="dna-locked">
                        <div class="dna-icon">
                            <img class="dna-icon__img" src="/static/${settings.DEFAULT_SITE_THEME}/images/dna/lock_icon.svg" alt="/">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


    % if course_sections is not None:
        <ol class="block-tree accordion"
            id="course-outline-block-tree"
            aria-labelledby="expand-collapse-outline-all-button">
        % for section in course_sections:
            <%
            section_is_auto_opened = section.get('resume_block') is True
            %>
                <li class="outline-item section">
                    <button class="section-name accordion-trigger"
                            aria-expanded="${ 'true' if section_is_auto_opened else 'false' }"
                            aria-controls="${ section['id'] }_contents"
                            id="${ section['id'] }">
                        <span class="fa fa-chevron-right ${ 'fa-rotate-90' if section_is_auto_opened else '' }" aria-hidden="true"></span>
                        <h3 class="section-title">${ section['display_name'] }</h3>
            % if section.get('complete'):
                            <span class="complete-checkmark fa fa-check"></span>
            % endif
                    </button>
                    <ol class="outline-item accordion-panel ${ '' if section_is_auto_opened else 'is-hidden' }"
                        id="${ section['id'] }_contents"
                        aria-labelledby="${ section['id'] }">
            % for subsection in section.get('children', []):
                <%
                gated_subsection = subsection['id'] in gated_content
                completed_prereqs = gated_content[subsection['id']]['completed_prereqs'] if gated_subsection else False
                subsection_is_auto_opened = subsection.get('resume_block') is True
                %>
                      <li class="subsection accordion ${ 'current' if subsection['resume_block'] else '' }">
                % if gated_subsection and not completed_prereqs:
                                <a href="${ subsection['lms_web_url'] }">
                                    <button class="subsection-text prerequisite-button"
                                            id="${ subsection['id'] }">
                                    <span class="menu-icon icon fa fa-lock"
                                            aria-hidden="true">
                                    </span>
                                    <h4 class="subsection-title">
                                        ${ subsection['display_name'] }
                                    </h4>
                                    <div class="details prerequisite">
                                        ${ _("Prerequisite: ") }
                                            <%
                                                prerequisite_id = gated_content[subsection['id']]['prerequisite']
                                                prerequisite_name = xblock_display_names.get(prerequisite_id)
                                            %>
                                            ${ prerequisite_name }
                                    </div>
                % else:
                                    <button class="subsection-text accordion-trigger"
                                            id="${ subsection['id'] }"
                                            aria-expanded="${ 'true' if subsection_is_auto_opened else 'false' }"
                                            aria-controls="${ subsection['id'] }_contents">
                                        <span class="fa fa-chevron-right ${ 'fa-rotate-90' if subsection_is_auto_opened else '' }"
                                              aria-hidden="true"></span>
                                        <h4 class="subsection-title">
                                            ${ subsection['display_name'] }
                                        </h4>
                    % if subsection.get('complete'):
                                        <span class="complete-checkmark fa fa-check"></span>
                    % endif
                % endif
                                        <div class="details">

                ## There are behavior differences between rendering of subsections which have
                ## exams (timed, graded, etc) and those that do not.
                ##
                ## Exam subsections expose exam status message field as well as a status icon
                <%
                if subsection.get('due') is None:
                    # examples: Homework, Lab, etc.
                    data_string = subsection.get('format')
                else:
                    if 'special_exam_info' in subsection:
                        data_string = _('due {date}')
                    else:
                        data_string = _("{subsection_format} due {{date}}").format(subsection_format=subsection.get('format'))
                %>
                % if subsection.get('format') or 'special_exam_info' in subsection:
                                            <span class="subtitle">
                    % if 'special_exam' in subsection:
                                                    ## Display the exam status icon and status message
                                                    <span
                                                        class="menu-icon icon fa ${subsection['special_exam_info'].get('suggested_icon', 'fa-pencil-square-o')} ${subsection['special_exam_info'].get('status', 'eligible')}"
                                                        aria-hidden="true"
                                                    ></span>
                                                    <span class="subtitle-name">
                                                        ${subsection['special_exam_info'].get('short_description', '')}
                                                    </span>

                        ## completed exam statuses should not show the due date
                        ## since the exam has already been submitted by the user
                        % if not subsection['special_exam_info'].get('in_completed_state', False):
                                                        <span
                                                            class="localized-datetime subtitle-name"
                                                            data-datetime="${subsection.get('due')}"
                                                            data-string="${data_string}"
                                                            data-timezone="${user_timezone}"
                                                            data-language="${user_language}"
                                                        ></span>
                        % endif
                    % else:
                                                    ## non-graded section, we just show the exam format and the due date
                                                    ## this is the standard case in edx-platform
                                                    <span
                                                        class="localized-datetime subtitle-name"
                                                        data-datetime="${subsection.get('due')}"
                                                        data-string="${data_string}"
                                                        data-timezone="${user_timezone}"
                                                        data-language="${user_language}"
                                                    ></span>

                        % if subsection.get('graded'):
                                                        <span class="sr">&nbsp;${_("This content is graded")}</span>
                        % endif
                    % endif
                                            </span>
                % endif
                                        </div> <!-- /details -->
                                    </button> <!-- /subsection-text -->
                % if gated_subsection and not completed_prereqs:
                                </a>
                % endif
                % if not gated_subsection or (gated_subsection and completed_prereqs):
                                <ol class="outline-item accordion-panel ${ '' if subsection_is_auto_opened else 'is-hidden' }"
                                    id="${ subsection['id'] }_contents"
                                    aria-labelledby="${ subsection['id'] }"
                                >
                    % for vertical in subsection.get('children', []):
                                    <li class="vertical outline-item focusable">
                                        <a class="outline-item focusable"
                                            href="${ vertical['lms_web_url'] }"
                                            id="${ vertical['id'] }">
                                            <div class="vertical-details">
                                              <div class="vertical-title">
                                                ${ vertical['display_name'] }
                                              </div>
                                                ## ${vertical}

                                            </div>
                        % if vertical.get('complete'):
                                                <span class="complete-checkmark fa fa-check"></span>
                        % endif
                                        </a>
                                    </li>
                    % endfor
                                </ol>
                % endif
                            </li>
            % endfor
                    </ol>
                </li>
        % endfor
        </ol>
    % endif
    <div id="modal-continue" data-show-popup="${popup}" class="onboarding-holder" style="display:none">
        <button class="modal-continue_close" title="Close" aria-label="Close"><span aria-hidden="true">×</span></button>
        <div class="onboarding-holder">
            <div class="onboarding-content">
                <h1>
                    What is HERA?
                </h1>
                <div class="onboarding-text-block">
                    <p>
                    Last time you signed out you were in the middle of a lesson. Would you like to pick up where you left off, or start that lesson over?
                    </p>
                </div>
                <div class="footer-controls-buttons-holder">
                    <a href="${start_over_url}" class="btn btn-prev">Start Over</a>
                    <a href="${resume_course_url}" class="btn btn-primary">Continue</a>
                </div>
            </div>
            <div class="mascot">
                <img class="mascot-image" src="/static/edx-theme/images/hera_mascot.png" alt="HERA-mascot" />
            </div>
        </div>
    </div>
</main>

<script type="text/javascript">
    var $modalContinue = $("#modal-continue");
    $modalContinue.popup({
        scrolllock: true,
        blur: false
    });
    var showPopup = $modalContinue.data('showPopup');
    if (showPopup === "True") {
        $modalContinue.popup('show');
    }
</script>

<%static:require_module_async module_name="js/dateutil_factory" class_name="DateUtilFactory">
    DateUtilFactory.transform('.localized-datetime');
</%static:require_module_async>

<%static:webpack entry="CourseOutline">
    new CourseOutline();
</%static:webpack>
